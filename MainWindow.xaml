<Window x:Class="OneNoteExporter.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Icon="icon.ico"
        Title="OneNote Backup Exporter"
        Width="900" Height="800"
        MinWidth="700" MinHeight="500"
        MaxWidth="1280" MaxHeight="1100"
        WindowStartupLocation="CenterScreen"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        Background="{StaticResource BgPage}">

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Header -->
            <RowDefinition Height="*"/>     <!-- Notebook list -->
            <RowDefinition Height="Auto"/>  <!-- Export controls -->
        </Grid.RowDefinitions>

        <!-- ════════════════════════════════════════════════════════
             ROW 0 – Header
             ════════════════════════════════════════════════════════ -->
        <Border Grid.Row="0"
                Background="{StaticResource BgCard}"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0,0,0,1"
                CornerRadius="5,5,0,0"
                Padding="15,10"
                Margin="0,0,0,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="OneNote Backup Exporter"
                           FontSize="18" FontWeight="Bold"
                           Foreground="{StaticResource PrimaryBlue}"
                           VerticalAlignment="Center"/>

                <!-- Version badge -->
                <Border Grid.Column="1"
                        x:Name="VersionBadge"
                        Background="{StaticResource InfoBg}"
                        BorderBrush="{StaticResource InfoBorder}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="8,4"
                        VerticalAlignment="Center">
                    <TextBlock x:Name="VersionText"
                               Text="Checking OneNote installation..."
                               Foreground="{StaticResource InfoFg}"
                               FontSize="12"/>
                </Border>
            </Grid>
        </Border>

        <!-- ════════════════════════════════════════════════════════
             ROW 1 – Notebook list
             ════════════════════════════════════════════════════════ -->
        <Border Grid.Row="1"
                Background="{StaticResource BgCard}"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="1"
                CornerRadius="5"
                Padding="12"
                Margin="0,0,0,8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Section header -->
                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0"
                               Text="Available Notebooks:"
                               FontSize="14" FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimary}"
                               VerticalAlignment="Center"/>
                    <Button Grid.Column="1"
                            x:Name="RefreshButton"
                            Content="Refresh"
                            Style="{StaticResource SmallButtonStyle}"
                            Click="RefreshButton_Click"/>
                </Grid>

                <!-- Notebook list area -->
                <Grid Grid.Row="1">
                    <!-- The actual list -->
                    <Border Background="{StaticResource BgList}"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            CornerRadius="4">
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled"
                                      Padding="8">
                            <ItemsControl x:Name="NotebookList">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="White"
                                                BorderBrush="#E0E0E0"
                                                BorderThickness="1"
                                                CornerRadius="5"
                                                Padding="10,8"
                                                Margin="0,0,0,6">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="BorderBrush" Value="{StaticResource ButtonBlue}"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                      IsEnabled="{Binding IsEnabled}"
                                                      Checked="Notebook_SelectionChanged"
                                                      Unchecked="Notebook_SelectionChanged"
                                                      Cursor="Hand">
                                                <StackPanel Margin="4,0,0,0">
                                                    <TextBlock Text="{Binding DisplayName}"
                                                               FontWeight="SemiBold"
                                                               FontSize="13"
                                                               Foreground="{StaticResource TextPrimary}"/>
                                                    <TextBlock Text="{Binding LastModifiedFormatted}"
                                                               FontSize="11"
                                                               Foreground="{StaticResource TextSecondary}"
                                                               Margin="0,2,0,0"/>
                                                </StackPanel>
                                            </CheckBox>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>

                    <!-- Overlay: Loading -->
                    <TextBlock x:Name="LoadingText"
                               Text="Loading notebooks..."
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Foreground="{StaticResource TextSecondary}"
                               FontSize="14"
                               Visibility="Collapsed"/>

                    <!-- Overlay: Empty -->
                    <TextBlock x:Name="EmptyText"
                               Text="No notebooks found"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Foreground="{StaticResource TextSecondary}"
                               FontSize="14"
                               Visibility="Collapsed"/>

                    <!-- Overlay: Error -->
                    <TextBlock x:Name="ErrorText"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Foreground="#DC3545"
                               FontSize="13"
                               TextWrapping="Wrap"
                               Margin="15"
                               Visibility="Collapsed"/>
                </Grid>
            </Grid>
        </Border>

        <!-- ════════════════════════════════════════════════════════
             ROW 2 – Export controls
             ════════════════════════════════════════════════════════ -->
        <Border Grid.Row="2"
                Background="{StaticResource BgCard}"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="1"
                CornerRadius="5"
                Padding="12,10">
            <StackPanel>

                <!-- Destination path row -->
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- TextBox with placeholder overlay -->
                    <Grid Grid.Column="0" Margin="0,0,8,0">
                        <TextBox x:Name="DestPathBox"/>
                        <TextBlock Text="Destination folder (e.g. C:\Backup)"
                                   Foreground="#AAAAAA"
                                   Margin="10,0,0,0"
                                   VerticalAlignment="Center"
                                   IsHitTestVisible="False"
                                   FontSize="13">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Text, ElementName=DestPathBox}" Value="">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>

                    <Button Grid.Column="1"
                            x:Name="BrowseButton"
                            Content="Browse..."
                            Style="{StaticResource GrayButtonStyle}"
                            Click="BrowseButton_Click"/>
                </Grid>

                <!-- Format selector row -->
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0"
                               Text="Export Format:"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"
                               FontSize="13"
                               Foreground="{StaticResource TextPrimary}"/>
                    <ComboBox Grid.Column="1"
                              x:Name="FormatCombo"
                              SelectionChanged="FormatCombo_SelectionChanged">
                        <ComboBoxItem Tag="onepkg" IsSelected="True">
                            OneNote Package (.onepkg) – Recommended, best quality
                        </ComboBoxItem>
                        <ComboBoxItem Tag="xps">
                            XPS Document (.xps) – Good layout preservation
                        </ComboBoxItem>
                        <ComboBoxItem Tag="pdf">
                            PDF Document (.pdf) – Universal, lower quality
                        </ComboBoxItem>
                        <ComboBoxItem x:Name="LocalBackupItem" Tag="localbackup">
                            Local Backup Copy – Fast, direct file copy
                        </ComboBoxItem>
                    </ComboBox>
                </Grid>

                <!-- Backup warning banner -->
                <Border x:Name="BackupWarning"
                        Background="{StaticResource WarningBg}"
                        BorderBrush="{StaticResource WarningBorder}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="10,7"
                        Margin="0,0,0,10"
                        Visibility="Collapsed">
                    <TextBlock Text="⚠  Local backup copies ALL notebooks (selection will be ignored)"
                               Foreground="{StaticResource WarningFg}"
                               FontSize="12"/>
                </Border>

                <!-- Export + Cancel buttons -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column="0"
                            x:Name="ExportButton"
                            Content="Export Selected"
                            Style="{StaticResource PrimaryButtonStyle}"
                            IsEnabled="False"
                            Margin="0,0,8,0"
                            Click="ExportButton_Click"/>
                    <Button Grid.Column="1"
                            x:Name="CancelButton"
                            Content="❌  Cancel"
                            Style="{StaticResource DangerButtonStyle}"
                            Visibility="Collapsed"
                            Click="CancelButton_Click"/>
                </Grid>

                <!-- Progress bar (indeterminate, shown during export) -->
                <ProgressBar x:Name="ExportProgressBar"
                             Height="4"
                             IsIndeterminate="True"
                             Margin="0,0,0,6"
                             Visibility="Collapsed"
                             Foreground="{StaticResource ButtonBlue}"
                             Background="#E9ECEF"/>

                <!-- Progress text -->
                <Border x:Name="ProgressArea"
                        Background="{StaticResource InfoBg}"
                        BorderBrush="{StaticResource InfoBorder}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="10,7"
                        Margin="0,0,0,6"
                        Visibility="Collapsed">
                    <TextBlock x:Name="ProgressText"
                               Foreground="{StaticResource InfoFg}"
                               FontSize="12"
                               TextWrapping="Wrap"/>
                </Border>

                <!-- Final status message -->
                <Border x:Name="StatusBorder"
                        CornerRadius="4"
                        Padding="10,8"
                        Visibility="Collapsed">
                    <TextBlock x:Name="StatusText"
                               FontSize="13"
                               TextWrapping="Wrap"
                               xml:space="preserve"/>
                </Border>

            </StackPanel>
        </Border>
    </Grid>
</Window>
